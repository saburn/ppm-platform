<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Resource Management - AI PPM Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .sidebar {
            background: linear-gradient(180deg, #2d3748 0%, #1a202c 100%);
        }
        .heatmap-cell {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .heatmap-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .approval-card {
            transition: all 0.3s ease;
        }
        .approval-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    <div class="sidebar fixed left-0 top-0 h-full w-64 text-white z-40">
        <div class="p-6">
            <div class="flex items-center mb-8">
                <i class="fas fa-chart-line text-2xl mr-3"></i>
                <h1 class="text-xl font-bold">AI PPM Pro</h1>
            </div>
            
            <nav class="space-y-2">
                <a href="dashboard-beautiful.html" class="flex items-center p-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    Dashboard
                </a>
                <a href="project-management-enterprise.html" class="flex items-center p-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition">
                    <i class="fas fa-project-diagram mr-3"></i>
                    Projects
                </a>
                <a href="gantt-chart-enterprise.html" class="flex items-center p-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition">
                    <i class="fas fa-chart-gantt mr-3"></i>
                    Gantt Charts
                </a>
                <a href="resource-allocation-enterprise.html" class="flex items-center p-3 rounded-lg bg-white bg-opacity-10">
                    <i class="fas fa-users-cog mr-3"></i>
                    Resources
                </a>
                <a href="raid-management-enterprise.html" class="flex items-center p-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition">
                    <i class="fas fa-shield-alt mr-3"></i>
                    RAID
                </a>
                <a href="automated-reports-enterprise.html" class="flex items-center p-3 rounded-lg hover:bg-white hover:bg-opacity-10 transition">
                    <i class="fas fa-file-alt mr-3"></i>
                    Reports
                </a>
            </nav>
        </div>
        
        <div class="absolute bottom-6 left-6 right-6">
            <button onclick="logout()" class="w-full flex items-center justify-center p-3 rounded-lg bg-red-600 hover:bg-red-700 transition">
                <i class="fas fa-sign-out-alt mr-2"></i>
                Logout
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="ml-64">
        <!-- Header -->
        <header class="bg-white shadow-sm px-8 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">Enterprise Resource Management</h2>
                    <p class="text-gray-600">Multi-level approval workflows and intelligent resource optimization</p>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="optimizeResources()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        <i class="fas fa-magic mr-2"></i>AI Optimize
                    </button>
                    <button onclick="openRequestModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                        <i class="fas fa-plus mr-2"></i>Resource Request
                    </button>
                    <div class="flex items-center">
                        <img src="https://picsum.photos/seed/avatar1/40/40.jpg" alt="User" class="w-10 h-10 rounded-full mr-3">
                        <div>
                            <div class="font-semibold">Demo User</div>
                            <div class="text-sm text-gray-600">Administrator</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="p-8">
            <!-- Resource Overview Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 bg-blue-100 rounded-lg">
                            <i class="fas fa-users text-blue-600 text-xl"></i>
                        </div>
                        <span class="text-sm text-green-600 font-semibold">85%</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800">142</h3>
                    <p class="text-gray-600">Total Resources</p>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 bg-green-100 rounded-lg">
                            <i class="fas fa-user-check text-green-600 text-xl"></i>
                        </div>
                        <span class="text-sm text-yellow-600 font-semibold">8 Pending</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800">121</h3>
                    <p class="text-gray-600">Allocated</p>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 bg-yellow-100 rounded-lg">
                            <i class="fas fa-user-clock text-yellow-600 text-xl"></i>
                        </div>
                        <span class="text-sm text-red-600 font-semibold">15 Overload</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800">21</h3>
                    <p class="text-gray-600">Available</p>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                        <div class="p-3 bg-purple-100 rounded-lg">
                            <i class="fas fa-dollar-sign text-purple-600 text-xl"></i>
                        </div>
                        <span class="text-sm text-green-600 font-semibold">$45K</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800">$2.4M</h3>
                    <p class="text-gray-600">Total Budget</p>
                </div>
            </div>

            <!-- Resource Utilization Heatmap -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Resource Utilization Heatmap</h3>
                    <div class="flex items-center space-x-4">
                        <select class="px-3 py-2 border rounded-lg">
                            <option>This Week</option>
                            <option>Next Week</option>
                            <option>This Month</option>
                        </select>
                        <button onclick="refreshHeatmap()" class="p-2 bg-gray-100 rounded hover:bg-gray-200 transition">
                            <i class="fas fa-sync"></i>
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left border-b">
                                <th class="pb-3">Resource</th>
                                <th class="pb-3">Role</th>
                                <th class="pb-3">Mon</th>
                                <th class="pb-3">Tue</th>
                                <th class="pb-3">Wed</th>
                                <th class="pb-3">Thu</th>
                                <th class="pb-3">Fri</th>
                                <th class="pb-3">Utilization</th>
                                <th class="pb-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b">
                                <td class="py-3 font-semibold">John Doe</td>
                                <td class="py-3">Developer</td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-green-500 heatmap-cell" onclick="showResourceDetails('John Doe', 'Monday', 80)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-yellow-500 heatmap-cell" onclick="showResourceDetails('John Doe', 'Tuesday', 100)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-green-500 heatmap-cell" onclick="showResourceDetails('John Doe', 'Wednesday', 75)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-red-500 heatmap-cell" onclick="showResourceDetails('John Doe', 'Thursday', 120)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-yellow-500 heatmap-cell" onclick="showResourceDetails('John Doe', 'Friday', 90)"></div>
                                </td>
                                <td class="py-3">
                                    <div class="flex items-center">
                                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-yellow-500 h-2 rounded-full" style="width: 93%"></div>
                                        </div>
                                        <span class="text-sm">93%</span>
                                    </div>
                                </td>
                                <td class="py-3">
                                    <button class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="border-b">
                                <td class="py-3 font-semibold">Jane Smith</td>
                                <td class="py-3">Designer</td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-green-500 heatmap-cell" onclick="showResourceDetails('Jane Smith', 'Monday', 60)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-green-500 heatmap-cell" onclick="showResourceDetails('Jane Smith', 'Tuesday', 70)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-yellow-500 heatmap-cell" onclick="showResourceDetails('Jane Smith', 'Wednesday', 85)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-green-500 heatmap-cell" onclick="showResourceDetails('Jane Smith', 'Thursday', 65)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-green-500 heatmap-cell" onclick="showResourceDetails('Jane Smith', 'Friday', 75)"></div>
                                </td>
                                <td class="py-3">
                                    <div class="flex items-center">
                                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 71%"></div>
                                        </div>
                                        <span class="text-sm">71%</span>
                                    </div>
                                </td>
                                <td class="py-3">
                                    <button class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="border-b">
                                <td class="py-3 font-semibold">Mike Johnson</td>
                                <td class="py-3">PM</td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-yellow-500 heatmap-cell" onclick="showResourceDetails('Mike Johnson', 'Monday', 95)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-red-500 heatmap-cell" onclick="showResourceDetails('Mike Johnson', 'Tuesday', 110)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-red-500 heatmap-cell" onclick="showResourceDetails('Mike Johnson', 'Wednesday', 115)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-yellow-500 heatmap-cell" onclick="showResourceDetails('Mike Johnson', 'Thursday', 100)"></div>
                                </td>
                                <td class="py-3 text-center">
                                    <div class="w-8 h-8 mx-auto rounded bg-yellow-500 heatmap-cell" onclick="showResourceDetails('Mike Johnson', 'Friday', 90)"></div>
                                </td>
                                <td class="py-3">
                                    <div class="flex items-center">
                                        <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                            <div class="bg-red-500 h-2 rounded-full" style="width: 102%"></div>
                                        </div>
                                        <span class="text-sm">102%</span>
                                    </div>
                                </td>
                                <td class="py-3">
                                    <button class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pending Approvals -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold mb-4">Pending Approvals</h3>
                    <div class="space-y-4">
                        <div class="approval-card border rounded-lg p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold">Senior Developer Request</h4>
                                    <p class="text-sm text-gray-600">Project: Mobile App Launch</p>
                                </div>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">Pending</span>
                            </div>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-sm">Requested by: Sarah Chen</span>
                                <span class="text-sm text-gray-600">2 hours ago</span>
                            </div>
                            <div class="bg-gray-50 p-3 rounded mb-3">
                                <p class="text-sm">Need senior developer for API integration phase. Duration: 3 weeks. Skills: React, Node.js, MongoDB.</p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="approveRequest(1)" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                                    <i class="fas fa-check mr-1"></i>Approve
                                </button>
                                <button onclick="rejectRequest(1)" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                    <i class="fas fa-times mr-1"></i>Reject
                                </button>
                                <button onclick="modifyRequest(1)" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                    <i class="fas fa-edit mr-1"></i>Modify
                                </button>
                            </div>
                        </div>

                        <div class="approval-card border rounded-lg p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold">UX Designer Allocation</h4>
                                    <p class="text-sm text-gray-600">Project: Website Redesign</p>
                                </div>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">Pending</span>
                            </div>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-sm">Requested by: Alex Kumar</span>
                                <span class="text-sm text-gray-600">5 hours ago</span>
                            </div>
                            <div class="bg-gray-50 p-3 rounded mb-3">
                                <p class="text-sm">UX Designer needed for user research and wireframing. Duration: 2 weeks. Skills: Figma, user testing.</p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="approveRequest(2)" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                                    <i class="fas fa-check mr-1"></i>Approve
                                </button>
                                <button onclick="rejectRequest(2)" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                    <i class="fas fa-times mr-1"></i>Reject
                                </button>
                                <button onclick="modifyRequest(2)" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                    <i class="fas fa-edit mr-1"></i>Modify
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Recommendations -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-bold mb-4">AI Resource Intelligence</h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-brain text-blue-600 mr-2"></i>
                                <span class="font-semibold text-blue-800">Optimization Opportunity</span>
                            </div>
                            <p class="text-sm text-blue-700 mb-2">3 resources identified for cross-project sharing</p>
                            <p class="text-xs text-blue-600">Potential savings: $45K annually</p>
                        </div>

                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-chart-line text-green-600 mr-2"></i>
                                <span class="font-semibold text-green-800">Capacity Forecast</span>
                            </div>
                            <p class="text-sm text-green-700 mb-2">Resource shortage expected in 3 weeks</p>
                            <p class="text-xs text-green-600">Recommendation: Start recruitment process</p>
                        </div>

                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-exclamation-triangle text-yellow-600 mr-2"></i>
                                <span class="font-semibold text-yellow-800">Burnout Risk</span>
                            </div>
                            <p class="text-sm text-yellow-700 mb-2">2 team members at high burnout risk</p>
                            <p class="text-xs text-yellow-600">Action: Rebalance workload immediately</p>
                        </div>

                        <div class="bg-purple-50 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-user-graduate text-purple-600 mr-2"></i>
                                <span class="font-semibold text-purple-800">Skill Gap Analysis</span>
                            </div>
                            <p class="text-sm text-purple-700 mb-2">Cloud architecture skills needed in Q1</p>
                            <p class="text-xs text-purple-600">Training program: AWS certification for 5 devs</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resource Performance Analytics -->
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="text-xl font-bold mb-4">Resource Performance Analytics</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">Team Utilization Trends</h4>
                        <canvas id="utilizationChart"></canvas>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3">Skills Distribution</h4>
                        <canvas id="skillsChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Resource Request Modal -->
    <div id="requestModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">New Resource Request</h3>
                <button onclick="closeRequestModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form onsubmit="submitResourceRequest(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Project *</label>
                        <select class="w-full p-3 border rounded-lg" required>
                            <option>Website Redesign</option>
                            <option>Mobile App Launch</option>
                            <option>Data Migration</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Resource Type *</label>
                        <select class="w-full p-3 border rounded-lg" required>
                            <option>Developer</option>
                            <option>Designer</option>
                            <option>Project Manager</option>
                            <option>QA Engineer</option>
                            <option>DevOps Engineer</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Experience Level *</label>
                        <select class="w-full p-3 border rounded-lg" required>
                            <option>Junior</option>
                            <option>Mid-level</option>
                            <option>Senior</option>
                            <option>Lead</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Duration (weeks) *</label>
                        <input type="number" class="w-full p-3 border rounded-lg" min="1" value="4" required>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Required Skills *</label>
                    <input type="text" class="w-full p-3 border rounded-lg" placeholder="e.g., React, Node.js, MongoDB" required>
                </div>

                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Justification *</label>
                    <textarea class="w-full p-3 border rounded-lg" rows="4" placeholder="Explain why this resource is needed..." required></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-gray-700 mb-2">Priority Level *</label>
                        <select class="w-full p-3 border rounded-lg" required>
                            <option>Critical</option>
                            <option>High</option>
                            <option>Medium</option>
                            <option>Low</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Budget Impact *</label>
                        <input type="number" class="w-full p-3 border rounded-lg" min="0" placeholder="$0" required>
                    </div>
                </div>

                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="closeRequestModal()" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Submit Request
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Utilization Chart
        const utilizationCtx = document.getElementById('utilizationChart').getContext('2d');
        new Chart(utilizationCtx, {
            type: 'line',
            data: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                datasets: [{
                    label: 'Development',
                    data: [85, 92, 88, 95, 89, 93],
                    borderColor: 'rgb(59, 130, 246)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Design',
                    data: [70, 75, 82, 78, 85, 80],
                    borderColor: 'rgb(16, 185, 129)',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Management',
                    data: [95, 98, 102, 100, 97, 99],
                    borderColor: 'rgb(147, 51, 234)',
                    backgroundColor: 'rgba(147, 51, 234, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });

        // Skills Chart
        const skillsCtx = document.getElementById('skillsChart').getContext('2d');
        new Chart(skillsCtx, {
            type: 'doughnut',
            data: {
                labels: ['Frontend', 'Backend', 'Full Stack', 'DevOps', 'Mobile', 'QA'],
                datasets: [{
                    data: [25, 20, 15, 12, 18, 10],
                    backgroundColor: [
                        'rgb(59, 130, 246)',
                        'rgb(16, 185, 129)',
                        'rgb(251, 146, 60)',
                        'rgb(147, 51, 234)',
                        'rgb(239, 68, 68)',
                        'rgb(156, 163, 175)'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });

        function openRequestModal() {
            document.getElementById('requestModal').classList.remove('hidden');
            document.getElementById('requestModal').classList.add('flex');
        }

        function closeRequestModal() {
            document.getElementById('requestModal').classList.add('hidden');
            document.getElementById('requestModal').classList.remove('flex');
        }

        // Advanced Workflow Management
        let workflowQueue = [];
        let escalationRules = [];
        let notifications = [];

        function submitResourceRequest(event) {
            event.preventDefault();
            
            // Create workflow request with advanced routing
            const request = {
                id: Date.now(),
                type: 'Resource Request',
                priority: event.target.priority.value,
                budget: event.target.budget.value,
                project: event.target.project.value,
                resourceType: event.target.resourceType.value,
                experience: event.target.experience.value,
                duration: event.target.duration.value,
                skills: event.target.skills.value,
                justification: event.target.justification.value,
                status: 'pending',
                submittedAt: new Date(),
                submittedBy: 'Demo User',
                workflow: generateApprovalWorkflow(event.target)
            };
            
            // Add to workflow queue with intelligent routing
            workflowQueue.push(request);
            
            // Route to appropriate approvers based on rules
            routeRequestForApproval(request);
            
            // Set up automated escalations
            setupEscalationRules(request);
            
            // Send notifications
            sendWorkflowNotifications(request);
            
            alert('Resource request submitted successfully! Advanced workflow initiated with intelligent routing and escalation rules.');
            closeRequestModal();
            refreshApprovalList();
        }

        function generateApprovalWorkflow(formData) {
            const workflow = [];
            const budget = parseFloat(formData.budget.value);
            const priority = formData.priority.value;
            
            // Multi-level approval based on budget and priority
            if (budget > 100000) {
                workflow.push({ level: 1, approver: 'Department Head', type: 'budget' });
                workflow.push({ level: 2, approver: 'Finance Director', type: 'budget' });
                workflow.push({ level: 3, approver: 'CFO', type: 'budget' });
            } else if (budget > 50000) {
                workflow.push({ level: 1, approver: 'Department Head', type: 'budget' });
                workflow.push({ level: 2, approver: 'Finance Director', type: 'budget' });
            } else {
                workflow.push({ level: 1, approver: 'Department Head', type: 'budget' });
            }
            
            // Resource availability approval
            workflow.push({ level: workflow.length + 1, approver: 'Resource Manager', type: 'availability' });
            
            // Priority-based routing
            if (priority === 'Critical') {
                workflow.unshift({ level: 0, approver: 'Emergency Response Team', type: 'priority' });
            }
            
            return workflow;
        }

        function routeRequestForApproval(request) {
            const currentStep = request.workflow.find(step => step.status === 'pending');
            
            if (currentStep) {
                // Intelligent routing based on approver availability
                const approver = findAvailableApprover(currentStep.approver);
                
                const notification = {
                    requestId: request.id,
                    approver: approver.name,
                    type: 'approval_required',
                    message: `Approval required for ${request.resourceType} request (${request.project})`,
                    priority: request.priority,
                    deadline: calculateApprovalDeadline(request.priority),
                    sentAt: new Date()
                };
                
                notifications.push(notification);
                console.log(`Request routed to ${approver.name} with deadline ${notification.deadline}`);
            }
        }

        function findAvailableApprover(approverRole) {
            // Simulate intelligent approver selection
            const approvers = {
                'Department Head': { name: 'Sarah Chen', available: true, workload: 0.7 },
                'Finance Director': { name: 'Michael Ross', available: true, workload: 0.8 },
                'CFO': { name: 'Jennifer Walsh', available: true, workload: 0.6 },
                'Resource Manager': { name: 'David Kim', available: true, workload: 0.5 },
                'Emergency Response Team': { name: 'Rapid Response', available: true, workload: 0.3 }
            };
            
            return approvers[approverRole] || { name: approverRole, available: true, workload: 0.5 };
        }

        function calculateApprovalDeadline(priority) {
            const deadlines = {
                'Critical': 2, // hours
                'High': 8,
                'Medium': 24,
                'Low': 48
            };
            
            const deadline = new Date();
            deadline.setHours(deadline.getHours() + (deadlines[priority] || 24));
            return deadline;
        }

        function setupEscalationRules(request) {
            const escalation = {
                requestId: request.id,
                rules: [
                    {
                        condition: 'deadline_exceeded',
                        action: 'escalate_to_next_level',
                        delay: calculateApprovalDeadline(request.priority)
                    },
                    {
                        condition: 'high_value',
                        action: 'notify_executive',
                        threshold: 100000
                    },
                    {
                        condition: 'critical_priority',
                        action: 'immediate_notification',
                        priority: 'Critical'
                    }
                ],
                createdAt: new Date()
            };
            
            escalationRules.push(escalation);
            console.log('Escalation rules configured for request:', request.id);
        }

        function sendWorkflowNotifications(request) {
            // Send notifications to all relevant parties
            const parties = ['requester', 'approvers', 'stakeholders'];
            
            parties.forEach(party => {
                const notification = {
                    requestId: request.id,
                    party: party,
                    type: 'workflow_update',
                    message: generateNotificationMessage(request, party),
                    channels: ['email', 'in_app', 'sms'],
                    sentAt: new Date()
                };
                
                notifications.push(notification);
            });
        }

        function generateNotificationMessage(request, party) {
            const messages = {
                requester: `Your resource request for ${request.resourceType} has been submitted and is pending approval.`,
                approvers: `Action required: Resource request approval needed for ${request.project}`,
                stakeholders: `Resource request update: ${request.resourceType} requested for ${request.project}`
            };
            
            return messages[party] || `Resource request update for ${request.project}`;
        }

        function approveRequest(id) {
            const request = workflowQueue.find(r => r.id === parseInt(id));
            
            if (request) {
                // Update workflow step
                const currentStep = request.workflow.find(step => step.status !== 'completed');
                
                if (currentStep) {
                    currentStep.status = 'completed';
                    currentStep.approvedBy = 'Demo User';
                    currentStep.approvedAt = new Date();
                    
                    // Check if more approvals needed
                    const nextStep = request.workflow.find(step => step.status === 'pending');
                    
                    if (nextStep) {
                        routeRequestForApproval(request);
                        alert(`Request ${id} approved at level ${currentStep.level}. Routed to next approver: ${nextStep.approver}`);
                    } else {
                        // Complete workflow
                        request.status = 'approved';
                        request.completedAt = new Date();
                        triggerAutomatedActions(request);
                        alert(`Request ${id} fully approved! Resource allocation initiated and stakeholders notified.`);
                    }
                }
                
                refreshApprovalList();
            }
        }

        function rejectRequest(id) {
            const request = workflowQueue.find(r => r.id === parseInt(id));
            
            if (request) {
                request.status = 'rejected';
                request.rejectedAt = new Date();
                request.rejectionReason = prompt('Please provide rejection reason:');
                
                // Send rejection notifications
                sendRejectionNotifications(request);
                
                alert(`Request ${id} rejected. Notifications sent to requester and stakeholders.`);
                refreshApprovalList();
            }
        }

        function modifyRequest(id) {
            const request = workflowQueue.find(r => r.id === parseInt(id));
            
            if (request) {
                // Open modification form with current data
                alert(`Opening modification form for request ${id}...\n\nCurrent request details:\n• Project: ${request.project}\n• Resource Type: ${request.resourceType}\n• Budget: $${request.budget}\n• Priority: ${request.priority}\n\nModification will reset workflow and require re-approval.`);
                
                // Implementation would open a modal with current data pre-filled
                // For now, just showing the concept
            }
        }

        function triggerAutomatedActions(request) {
            // Trigger automated actions upon approval
            const actions = [
                'Allocate resource in scheduling system',
                'Update project budget and timeline',
                'Notify resource manager',
                'Create onboarding tasks',
                'Schedule welcome meeting',
                'Update capacity planning'
            ];
            
            actions.forEach(action => {
                console.log(`Automated action: ${action}`);
            });
            
            // Update dashboard stats
            updateDashboardStats();
        }

        function sendRejectionNotifications(request) {
            const notification = {
                requestId: request.id,
                type: 'rejection',
                message: `Resource request rejected: ${request.rejectionReason || 'No reason provided'}`,
                channels: ['email', 'in_app'],
                sentAt: new Date()
            };
            
            notifications.push(notification);
        }

        function refreshApprovalList() {
            // Refresh the approval list display
            console.log('Approval list refreshed with latest workflow data');
            // In real implementation, this would update the DOM
        }

        function updateDashboardStats() {
            // Update dashboard statistics
            console.log('Dashboard stats updated with new approval data');
        }

        // Advanced automation monitoring
        setInterval(() => {
            checkEscalationRules();
            monitorWorkflowDeadlines();
            updateRealTimeStats();
        }, 60000); // Check every minute

        function checkEscalationRules() {
            const now = new Date();
            
            escalationRules.forEach(rule => {
                const request = workflowQueue.find(r => r.id === rule.requestId);
                
                if (request && request.status === 'pending') {
                    rule.rules.forEach(r => {
                        if (r.condition === 'deadline_exceeded' && now > r.delay) {
                            escalateRequest(request);
                        } else if (r.condition === 'high_value' && parseFloat(request.budget) > r.threshold) {
                            notifyExecutives(request);
                        }
                    });
                }
            });
        }

        function escalateRequest(request) {
            console.log(`Escalating request ${request.id} due to deadline exceeded`);
            
            const notification = {
                type: 'escalation',
                message: `Request ${request.id} escalated due to deadline exceeded`,
                requestId: request.id,
                escalatedAt: new Date()
            };
            
            notifications.push(notification);
        }

        function notifyExecutives(request) {
            console.log(`Notifying executives of high-value request ${request.id}`);
            
            const notification = {
                type: 'executive_notification',
                message: `High-value resource request requires executive attention: $${request.budget}`,
                requestId: request.id,
                notifiedAt: new Date()
            };
            
            notifications.push(notification);
        }

        function monitorWorkflowDeadlines() {
            const now = new Date();
            
            workflowQueue.forEach(request => {
                if (request.status === 'pending') {
                    const currentStep = request.workflow.find(step => step.status === 'pending');
                    
                    if (currentStep) {
                        const timeRemaining = calculateApprovalDeadline(request.priority) - now;
                        
                        if (timeRemaining < 3600000) { // Less than 1 hour
                            sendDeadlineReminder(request, currentStep);
                        }
                    }
                }
            });
        }

        function sendDeadlineReminder(request, step) {
            console.log(`Sending deadline reminder for request ${request.id} to ${step.approver}`);
        }

        function updateRealTimeStats() {
            // Update real-time statistics for dashboard
            const stats = {
                pendingRequests: workflowQueue.filter(r => r.status === 'pending').length,
                approvalsToday: notifications.filter(n => n.type === 'approval_required' && isToday(n.sentAt)).length,
                escalations: notifications.filter(n => n.type === 'escalation').length
            };
            
            console.log('Real-time stats updated:', stats);
        }

        function isToday(date) {
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }

        function showResourceDetails(resource, day, utilization) {
            const status = utilization > 100 ? 'Overloaded' : utilization > 80 ? 'High' : utilization > 50 ? 'Normal' : 'Underutilized';
            alert(`${resource} - ${day}\nUtilization: ${utilization}%\nStatus: ${status}\n\nClick to view detailed schedule and projects.`);
        }

        function optimizeResources() {
            alert('AI Resource Optimization:\n\nRecommendations:\n• Reallocate 3 developers from low-priority projects\n• Cross-train 2 designers for full-stack tasks\n• Implement agile resource pooling\n\nExpected savings: $45K annually, 15% efficiency improvement');
        }

        function refreshHeatmap() {
            alert('Resource utilization data refreshed with latest updates.');
        }

        function logout() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>