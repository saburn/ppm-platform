<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracking - Core | PPM System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-on-track { background: #10b981; color: white; }
        .status-at-risk { background: #f59e0b; color: white; }
        .status-over-budget { background: #ef4444; color: white; }
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-dollar-sign text-3xl"></i>
                    <div>
                        <h1 class="text-3xl font-bold">Budget Tracking</h1>
                        <p class="text-purple-200">Financial Management & Cost Control</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="showAddBudgetPanel()" class="bg-white text-purple-600 px-6 py-2 rounded-lg font-semibold hover:bg-purple-50 transition">
                        <i class="fas fa-plus mr-2"></i>Add Budget
                    </button>
                    <button onclick="exportBudgets()" class="bg-purple-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-purple-600 transition">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <i class="fas fa-wallet text-blue-600 text-2xl"></i>
                    </div>
                    <span class="text-green-600 text-sm font-semibold">
                        <i class="fas fa-arrow-up mr-1"></i>2.3%
                    </span>
                </div>
                <h3 class="text-gray-500 text-sm font-medium mb-1">Total Budget</h3>
                <p class="text-3xl font-bold text-gray-900">$8.4M</p>
                <p class="text-sm text-gray-500 mt-2">Across 42 projects</p>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-green-100 p-3 rounded-lg">
                        <i class="fas fa-chart-line text-green-600 text-2xl"></i>
                    </div>
                    <span class="text-green-600 text-sm font-semibold">68%</span>
                </div>
                <h3 class="text-gray-500 text-sm font-medium mb-1">Spent</h3>
                <p class="text-3xl font-bold text-gray-900">$5.7M</p>
                <p class="text-sm text-gray-500 mt-2">$2.7M remaining</p>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-orange-100 p-3 rounded-lg">
                        <i class="fas fa-exclamation-triangle text-orange-600 text-2xl"></i>
                    </div>
                    <span class="text-orange-600 text-sm font-semibold">12</span>
                </div>
                <h3 class="text-gray-500 text-sm font-medium mb-1">At Risk</h3>
                <p class="text-3xl font-bold text-gray-900">$1.2M</p>
                <p class="text-sm text-gray-500 mt-2">14% of total budget</p>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <div class="bg-purple-100 p-3 rounded-lg">
                        <i class="fas fa-piggy-bank text-purple-600 text-2xl"></i>
                    </div>
                    <span class="text-green-600 text-sm font-semibold">
                        <i class="fas fa-arrow-down mr-1"></i>$450K
                    </span>
                </div>
                <h3 class="text-gray-500 text-sm font-medium mb-1">Savings</h3>
                <p class="text-3xl font-bold text-gray-900">$850K</p>
                <p class="text-sm text-gray-500 mt-2">10.1% under budget</p>
            </div>
        </div>

        <!-- Budget Overview & Variance Analysis -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Budget Overview Chart -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-900">Budget Overview</h2>
                    <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option>All Projects</option>
                        <option>Active Projects</option>
                        <option>Completed Projects</option>
                    </select>
                </div>
                <canvas id="budgetOverviewChart" style="max-height: 300px;"></canvas>
            </div>

            <!-- Variance Analysis -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-900">Variance Analysis</h2>
                    <button class="text-purple-600 hover:text-purple-700 text-sm font-semibold">
                        View Details <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                </div>
                <canvas id="varianceChart" style="max-height: 300px;"></canvas>
            </div>
        </div>

        <!-- Budget Allocation by Category -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900">Budget Allocation by Category</h2>
                <div class="flex items-center space-x-2">
                    <button class="px-4 py-2 bg-purple-100 text-purple-600 rounded-lg text-sm font-semibold">
                        Monthly
                    </button>
                    <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm font-semibold">
                        Quarterly
                    </button>
                    <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm font-semibold">
                        Yearly
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <canvas id="categoryChart" style="max-height: 250px;"></canvas>
                </div>
                <div class="md:col-span-2">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 bg-blue-500 rounded"></div>
                                <span class="font-semibold text-gray-900">Personnel</span>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold text-gray-900">$3.8M</p>
                                <p class="text-sm text-gray-500">45% of budget</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 bg-green-500 rounded"></div>
                                <span class="font-semibold text-gray-900">Infrastructure</span>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold text-gray-900">$2.1M</p>
                                <p class="text-sm text-gray-500">25% of budget</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 bg-purple-500 rounded"></div>
                                <span class="font-semibold text-gray-900">Software & Tools</span>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold text-gray-900">$1.5M</p>
                                <p class="text-sm text-gray-500">18% of budget</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-4 h-4 bg-orange-500 rounded"></div>
                                <span class="font-semibold text-gray-900">Other</span>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-bold text-gray-900">$1.0M</p>
                                <p class="text-sm text-gray-500">12% of budget</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Budget Table -->
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900">Project Budgets</h2>
                <div class="flex items-center space-x-4">
                    <input type="text" placeholder="Search projects..." class="border border-gray-300 rounded-lg px-4 py-2 text-sm w-64">
                    <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        <option>All Status</option>
                        <option>On Track</option>
                        <option>At Risk</option>
                        <option>Over Budget</option>
                    </select>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200">
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Project</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Budget</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Spent</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Remaining</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Variance</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Progress</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Status</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="budgetTableBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Add Budget Panel -->
    <div id="addBudgetPanel" class="hidden fixed inset-y-0 right-0 w-96 bg-white shadow-2xl z-50 overflow-y-auto">
        <div class="p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900">Add Budget</h3>
                <button onclick="closeAddBudgetPanel()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="addBudget(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                    <input type="text" required class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Budget</label>
                    <input type="number" required class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select class="w-full border border-gray-300 rounded-lg px-4 py-2">
                        <option>Personnel</option>
                        <option>Infrastructure</option>
                        <option>Software & Tools</option>
                        <option>Other</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                    <input type="date" required class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                    <input type="date" required class="w-full border border-gray-300 rounded-lg px-4 py-2">
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition">
                        Add Budget
                    </button>
                    <button type="button" onclick="closeAddBudgetPanel()" class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-300 transition">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample budget data
        const budgets = [
            { id: 1, project: 'Cloud Migration', budget: 450000, spent: 315000, variance: -15000, progress: 72, status: 'on-track' },
            { id: 2, project: 'Mobile App Development', budget: 280000, spent: 245000, variance: -35000, progress: 85, status: 'at-risk' },
            { id: 3, project: 'Data Analytics Platform', budget: 520000, spent: 380000, variance: 25000, progress: 68, status: 'on-track' },
            { id: 4, project: 'Security Enhancement', budget: 180000, spent: 195000, variance: -15000, progress: 95, status: 'over-budget' },
            { id: 5, project: 'CRM Implementation', budget: 350000, spent: 210000, variance: 45000, progress: 58, status: 'on-track' },
            { id: 6, project: 'Infrastructure Upgrade', budget: 620000, spent: 465000, variance: 35000, progress: 71, status: 'on-track' },
            { id: 7, project: 'AI Integration', budget: 480000, spent: 425000, variance: -25000, progress: 82, status: 'at-risk' },
            { id: 8, project: 'Website Redesign', budget: 150000, spent: 135000, variance: 5000, progress: 88, status: 'on-track' }
        ];

        // Render budget table
        function renderBudgetTable() {
            const tbody = document.getElementById('budgetTableBody');
            tbody.innerHTML = budgets.map(budget => {
                const remaining = budget.budget - budget.spent;
                const statusClass = budget.status === 'on-track' ? 'status-on-track' : 
                                   budget.status === 'at-risk' ? 'status-at-risk' : 'status-over-budget';
                const statusText = budget.status === 'on-track' ? 'On Track' : 
                                  budget.status === 'at-risk' ? 'At Risk' : 'Over Budget';
                
                return `
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-4 px-4">
                            <div class="font-semibold text-gray-900">${budget.project}</div>
                        </td>
                        <td class="py-4 px-4 text-gray-900">$${(budget.budget / 1000).toFixed(0)}K</td>
                        <td class="py-4 px-4 text-gray-900">$${(budget.spent / 1000).toFixed(0)}K</td>
                        <td class="py-4 px-4 text-gray-900">$${(remaining / 1000).toFixed(0)}K</td>
                        <td class="py-4 px-4">
                            <span class="${budget.variance >= 0 ? 'text-green-600' : 'text-red-600'} font-semibold">
                                ${budget.variance >= 0 ? '+' : ''}$${(budget.variance / 1000).toFixed(0)}K
                            </span>
                        </td>
                        <td class="py-4 px-4">
                            <div class="flex items-center space-x-2">
                                <div class="progress-bar flex-1">
                                    <div class="progress-fill bg-purple-600" style="width: ${budget.progress}%"></div>
                                </div>
                                <span class="text-sm text-gray-600">${budget.progress}%</span>
                            </div>
                        </td>
                        <td class="py-4 px-4">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </td>
                        <td class="py-4 px-4">
                            <button onclick="viewBudgetDetails(${budget.id})" class="text-purple-600 hover:text-purple-700">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Initialize charts
        function initCharts() {
            // Budget Overview Chart
            const ctx1 = document.getElementById('budgetOverviewChart').getContext('2d');
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Spent', 'Remaining', 'At Risk'],
                    datasets: [{
                        data: [5700000, 1500000, 1200000],
                        backgroundColor: ['#10b981', '#6366f1', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Variance Chart
            const ctx2 = document.getElementById('varianceChart').getContext('2d');
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Positive Variance',
                        data: [45, 52, 38, 65, 48, 55],
                        backgroundColor: '#10b981'
                    }, {
                        label: 'Negative Variance',
                        data: [-25, -18, -32, -15, -28, -22],
                        backgroundColor: '#ef4444'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Category Chart
            const ctx3 = document.getElementById('categoryChart').getContext('2d');
            new Chart(ctx3, {
                type: 'doughnut',
                data: {
                    labels: ['Personnel', 'Infrastructure', 'Software', 'Other'],
                    datasets: [{
                        data: [3800000, 2100000, 1500000, 1000000],
                        backgroundColor: ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Panel functions
        function showAddBudgetPanel() {
            document.getElementById('addBudgetPanel').classList.remove('hidden');
        }

        function closeAddBudgetPanel() {
            document.getElementById('addBudgetPanel').classList.add('hidden');
        }

        function addBudget(event) {
            event.preventDefault();
            showToast('Budget added successfully!', 'success');
            closeAddBudgetPanel();
        }

        function viewBudgetDetails(id) {
            showToast('Opening budget details...', 'info');
        }

        function exportBudgets() {
            showToast('Exporting budgets...', 'success');
        }

        // Toast notification
        function showToast(message, type) {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            toast.className = `toast ${bgColor} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} text-xl"></i>
                <span class="font-semibold">${message}</span>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderBudgetTable();
            initCharts();
        });
    </script>
</body>
</html>